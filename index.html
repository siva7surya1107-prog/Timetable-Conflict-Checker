<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Time Table Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .welcome-text {
            margin-right: 15px;
            font-weight: 500;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid white;
            color: white;
        }

        .btn-primary {
            background: white;
            color: #6a11cb;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .page {
            display: none;
            padding: 30px 0;
        }

        .active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }

        .btn-block {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            font-size: 16px;
            margin-top: 10px;
        }

        .text-center {
            text-align: center;
        }

        .link {
            color: #6a11cb;
            text-decoration: none;
            cursor: pointer;
        }

        .link:hover {
            text-decoration: underline;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 28px;
        }

        h2 {
            color: #444;
            margin: 25px 0 15px;
            font-size: 22px;
        }

        .welcome {
            margin-bottom: 20px;
            color: #666;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
            background: white;
        }

        /* Auth page styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }

        .auth-card {
            max-width: 400px;
            width: 100%;
        }

        .auth-options {
            margin-top: 20px;
            text-align: center;
        }

        /* Dashboard specific styles */
        .add-slot-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .full-width {
            grid-column: span 2;
        }

        .time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .time-inputs .form-control {
            flex: 1;
        }

        .schedule-grid {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            table-layout: fixed;
        }

        .schedule-grid th, .schedule-grid td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            height: 50px;
            vertical-align: top;
        }

        .schedule-grid th {
            background-color: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .schedule-grid .time-column {
            background-color: #f8f9fa;
            font-weight: 500;
            width: 80px;
        }

        .subject-block {
            padding: 6px;
            border-radius: 4px;
            font-size: 12px;
            text-align: left;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin: 2px 0;
        }

        .subject-block strong {
            display: block;
            margin-bottom: 2px;
        }

        .subject-block small {
            display: block;
            font-size: 10px;
            opacity: 0.9;
            margin-top: 2px;
        }

        /* Section-specific colors */
        .section-B {
            background: linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%);
            color: white;
        }

        .section-D {
            background: linear-gradient(135deg, #8E2DE2 0%, #4A00E0 100%);
            color: white;
        }

        .section-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 4px;
        }

        .view-toggle {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }

        .toggle-btn {
            padding: 8px 16px;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
        }

        .toggle-btn.active {
            background: #6a11cb;
            color: white;
        }

        .list-view {
            display: none;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .list-item:hover {
            background-color: #f9f9f9;
        }

        .grid-container {
            max-height: 600px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .conflict {
            background-color: #ffebee;
            border: 1px solid #f44336;
        }

        .conflict-warning {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
            font-weight: 500;
        }

        .section-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .section-selector label {
            margin-bottom: 0;
            font-weight: 500;
        }

        .section-selector .form-control {
            width: auto;
            min-width: 150px;
        }

        /* Clear timetable button styles */
        .clear-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
            gap: 10px;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
        }
        
        /* Added styles for hidden cells */
        .hidden-cell {
            display: none !important;
        }
        
        /* Modal styles for viewing timetable */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .modal-schedule-grid {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            table-layout: fixed;
        }
        
        .modal-schedule-grid th, .modal-schedule-grid td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            height: 50px;
            vertical-align: top;
        }
        
        .modal-schedule-grid th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .modal-schedule-grid .time-column {
            background-color: #f8f9fa;
            font-weight: 500;
            width: 80px;
        }
        
        .modal-subject-block {
            padding: 6px;
            border-radius: 4px;
            font-size: 12px;
            text-align: left;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin: 2px 0;
        }
        
        /* Time slot selector styles */
        .time-slot-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .time-slot-option {
            display: flex;
            align-items: center;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .time-slot-option:hover {
            background-color: #f0f0f0;
        }
        
        .time-slot-option.selected {
            background-color: #e6f2ff;
            border-color: #6a11cb;
        }
        
        .time-slot-radio {
            margin-right: 10px;
        }
        
        .time-slot-label {
            flex: 1;
        }
    </style>
</head>
<body>
    <!-- Sign In Page -->
    <div id="signin-page" class="page active">
        <header>
            <div class="header-content">
                <div class="logo">Time Table Conflict Checker</div>
                <div class="auth-buttons">
                    <button class="btn btn-outline" id="showSignin">Sign In</button>
                    <button class="btn btn-primary" id="showSignup">Sign Up</button>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="auth-container">
                <div class="card auth-card">
                    <h1 class="text-center">Sign In To Manage Your Schedule</h1>
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" class="form-control" placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password">
                    </div>
                    <button class="btn btn-block" id="signin-btn">Sign In</button>
                    <div class="auth-options">
                        <p>Don't have an account? <a href="#" class="link" id="goto-signup">Sign Up</a></p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>© 2023 Time Table Conflict Checker. All rights reserved.</p>
        </footer>
    </div>

    <!-- Sign Up Page -->
    <div id="signup-page" class="page">
        <header>
            <div class="header-content">
                <div class="logo">Time Table Conflict Checker</div>
                <div class="auth-buttons">
                    <button class="btn btn-outline" id="showSignin2">Sign In</button>
                    <button class="btn btn-primary" id="showSignup2">Sign Up</button>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="auth-container">
                <div class="card auth-card">
                    <h1 class="text-center">Create Account</h1>
                    <p class="text-center">Sign up to start managing your schedule</p>
                    <div class="form-group">
                        <label for="new-username">Username</label>
                        <input type="text" id="new-username" class="form-control" placeholder="Choose a username">
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="new-password">Password</label>
                        <input type="password" id="new-password" class="form-control" placeholder="Create a password">
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password</label>
                        <input type="password" id="confirm-password" class="form-control" placeholder="Confirm your password">
                    </div>
                    <button class="btn btn-block" id="signup-btn">Sign Up</button>
                    <div class="auth-options">
                        <p>Already have an account? <a href="#" class="link" id="goto-signin">Sign In</a></p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>© 2023 Time Table Conflict Checker. All rights reserved.</p>
        </footer>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page">
        <header>
            <div class="header-content">
                <div class="logo">Time Table Conflict Checker</div>
                <div class="auth-buttons">
                    <span class="welcome-text">Welcome, <span id="header-username">User</span></span>
                    <button class="btn btn-outline" id="logout-btn">Logout</button>
                </div>
            </div>
        </header>

        <div class="container">
            <h1>Time Table Conflict Checker</h1>
            <p class="welcome">Welcome, <span id="user-name">User</span></p>
            
            <div class="card">
                <h2>+ Add Time Slots</h2>
                <p>Add a new subject to your schedule</p>
                <div class="add-slot-form">
                    <div class="form-group">
                        <label for="section">Section</label>
                        <select id="section" class="form-control">
                            <option value="">Select Section</option>
                            <option value="B">Section B</option>
                            <option value="D">Section D</option>
                        </select>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="subject-name">Subject Name</label>
                        <input type="text" id="subject-name" class="form-control" placeholder="e.g., Mathematics">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="teacher-name">Teacher Name</label>
                        <input type="text" id="teacher-name" class="form-control" placeholder="e.g., Dr. Smith">
                    </div>
                    
                    <div class="form-group">
                        <label for="day">Day</label>
                        <select id="day" class="form-control">
                            <option value="">Select a day</option>
                            <option value="Mon">Monday</option>
                            <option value="Tue">Tuesday</option>
                            <option value="Wed">Wednesday</option>
                            <option value="Thu">Thursday</option>
                            <option value="Fri">Friday</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Time Slot</label>
                        <div class="time-slot-selector" id="time-slot-selector">
                            <!-- Time slots will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <button class="btn btn-block" id="add-slot-btn">+ Add Time Slot</button>
                <div id="conflict-warning" class="conflict-warning"></div>
            </div>
            
            <div class="card">
                <h2>Weekly Schedule</h2>
                <p>Your time table in grid format</p>
                
                <div class="section-selector">
                    <label for="section-filter">View Schedule for:</label>
                    <select id="section-filter" class="form-control">
                        <option value="all">All Sections</option>
                        <option value="B">Section B</option>
                        <option value="D">Section D</option>
                    </select>
                </div>
                
                <div class="view-toggle">
                    <button class="toggle-btn active" id="grid-view-btn">Grid View</button>
                    <button class="toggle-btn" id="list-view-btn">List View</button>
                </div>
                
                <div class="clear-section">
                    <button class="btn btn-success" id="save-timetable-btn">Save Timetable</button>
                    <button class="btn btn-primary" id="view-timetable-btn">View Timetable</button>
                    <button class="btn btn-danger" id="clear-timetable-btn">Clear Entire Timetable</button>
                </div>
                
                <div id="grid-view">
                    <div class="grid-container">
                        <table class="schedule-grid">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Mon</th>
                                    <th>Tue</th>
                                    <th>Wed</th>
                                    <th>Thu</th>
                                    <th>Fri</th>
                                </tr>
                            </thead>
                            <tbody id="schedule-body">
                                <!-- Time slots will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="list-view" class="list-view">
                    <div class="list-header">
                        <h3>Your Schedule</h3>
                    </div>
                    <div id="schedule-list">
                        <!-- List items will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2023 Time Table Conflict Checker. All rights reserved.</p>
        </footer>
    </div>

    <!-- View Timetable Modal -->
    <div id="view-timetable-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">View Timetable</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="section-selector">
                    <label for="modal-section-filter">View Schedule for:</label>
                    <select id="modal-section-filter" class="form-control">
                        <option value="all">All Sections</option>
                        <option value="B">Section B</option>
                        <option value="D">Section D</option>
                    </select>
                </div>
                <div class="grid-container">
                    <table class="modal-schedule-grid">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Mon</th>
                                <th>Tue</th>
                                <th>Wed</th>
                                <th>Thu</th>
                                <th>Fri</th>
                            </tr>
                        </thead>
                        <tbody id="modal-schedule-body">
                            <!-- Time slots will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Define the fixed time slots
        const fixedTimeSlots = [
            { id: 1, start: "08:15", end: "09:05", label: "8:15-9:05" },
            { id: 2, start: "09:05", end: "09:55", label: "9:05-9:55" },
            { id: 3, start: "10:10", end: "11:00", label: "10:10-11:00" },
            { id: 4, start: "11:00", end: "11:45", label: "11:00-11:45" },
            { id: 5, start: "11:45", end: "12:35", label: "11:45-12:35" },
            { id: 6, start: "13:30", end: "14:15", label: "1:30-2:15" },
            { id: 7, start: "14:15", end: "15:00", label: "2:15-3:00" },
            { id: 8, start: "15:00", end: "15:45", label: "3:00-3:45" }
        ];

        // Authentication functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                showPage('dashboard-page');
                initDashboard();
                return;
            }
            
            // Show sign in page by default
            showPage('signin-page');
            
            // Sign in functionality
            document.getElementById('signin-btn').addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (username && password) {
                    // Store username for dashboard
                    localStorage.setItem('currentUser', username);
                    // Redirect to dashboard
                    showPage('dashboard-page');
                    // Initialize dashboard
                    initDashboard();
                } else {
                    alert('Please enter both username and password');
                }
            });
            
            // Sign up functionality
            document.getElementById('signup-btn').addEventListener('click', function() {
                const username = document.getElementById('new-username').value;
                const email = document.getElementById('email').value;
                const password = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                if (username && email && password && confirmPassword) {
                    if (password === confirmPassword) {
                        // Store user data
                        const userData = {
                            username: username,
                            email: email,
                            password: password
                        };
                        
                        localStorage.setItem('user_' + username, JSON.stringify(userData));
                        // Store as current user and redirect
                        localStorage.setItem('currentUser', username);
                        showPage('dashboard-page');
                        // Initialize dashboard
                        initDashboard();
                    } else {
                        alert('Passwords do not match');
                    }
                } else {
                    alert('Please fill all fields');
                }
            });
            
            // Navigation between auth pages
            document.getElementById('goto-signup').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('signup-page');
            });
            
            document.getElementById('goto-signin').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('signin-page');
            });
            
            document.getElementById('showSignin').addEventListener('click', function() {
                showPage('signin-page');
            });
            
            document.getElementById('showSignin2').addEventListener('click', function() {
                showPage('signin-page');
            });
            
            document.getElementById('showSignup').addEventListener('click', function() {
                showPage('signup-page');
            });
            
            document.getElementById('showSignup2').addEventListener('click', function() {
                showPage('signup-page');
            });
        });
        
        // Show specific page and hide others
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }
        
        // Dashboard functionality for multiple sections with teacher conflict detection
        let scheduleItems = [];
        
        function initDashboard() {
            // Set username in dashboard
            const currentUser = localStorage.getItem('currentUser');
            document.getElementById('user-name').textContent = currentUser;
            document.getElementById('header-username').textContent = currentUser;
            
            // Initialize time slot selector
            initializeTimeSlotSelector();
            
            // Logout functionality
            document.getElementById('logout-btn').addEventListener('click', function() {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('schedule_' + currentUser);
                showPage('signin-page');
            });
            
            // View Toggle
            const gridViewBtn = document.getElementById('grid-view-btn');
            const listViewBtn = document.getElementById('list-view-btn');
            
            gridViewBtn.addEventListener('click', function() {
                document.getElementById('grid-view').style.display = 'block';
                document.getElementById('list-view').style.display = 'none';
                this.classList.add('active');
                listViewBtn.classList.remove('active');
            });
            
            listViewBtn.addEventListener('click', function() {
                document.getElementById('grid-view').style.display = 'none';
                document.getElementById('list-view').style.display = 'block';
                this.classList.add('active');
                gridViewBtn.classList.remove('active');
            });
            
            // Section filter
            document.getElementById('section-filter').addEventListener('change', function() {
                renderScheduleItems();
            });
            
            // Generate time slots for the schedule grid using fixed time slots
            generateTimeSlots();
            
            // Add time slot functionality
            document.getElementById('add-slot-btn').addEventListener('click', function() {
                const subject = document.getElementById('subject-name').value;
                const teacher = document.getElementById('teacher-name').value;
                const day = document.getElementById('day').value;
                const section = document.getElementById('section').value;
                
                // Get selected time slot
                const selectedTimeSlot = document.querySelector('.time-slot-option.selected');
                if (!selectedTimeSlot) {
                    alert('Please select a time slot');
                    return;
                }
                
                const timeSlotId = parseInt(selectedTimeSlot.dataset.id);
                const timeSlot = fixedTimeSlots.find(slot => slot.id === timeSlotId);
                
                if (!subject || !teacher || !day || !section) {
                    alert('Please fill all fields');
                    return;
                }
                
                // Create new schedule item
                const newItem = {
                    id: Date.now(), // Unique ID for each item
                    subject,
                    teacher,
                    day,
                    section,
                    startTime: timeSlot.start,
                    endTime: timeSlot.end,
                    timeSlotLabel: timeSlot.label,
                    startMinutes: timeToMinutes(timeSlot.start),
                    endMinutes: timeToMinutes(timeSlot.end)
                };
                
                // Check for conflicts
                const conflictResult = hasTimeConflict(newItem);
                if (conflictResult.hasConflict) {
                    document.getElementById('conflict-warning').textContent = 
                        `Warning: ${conflictResult.message}`;
                    return;
                } else {
                    document.getElementById('conflict-warning').textContent = "";
                }
                
                // Add to schedule items
                scheduleItems.push(newItem);
                
                // Save to localStorage
                saveScheduleItems();
                
                // Update views
                renderScheduleItems();
                
                // Clear form
                document.getElementById('subject-name').value = '';
                document.getElementById('teacher-name').value = '';
                document.getElementById('day').value = '';
                document.getElementById('section').value = '';
                
                // Reset time slot selection
                document.querySelectorAll('.time-slot-option').forEach(option => {
                    option.classList.remove('selected');
                });
            });
            
            // Save timetable functionality
            document.getElementById('save-timetable-btn').addEventListener('click', function() {
                // Save to localStorage
                saveScheduleItems();
                
                // Create a downloadable JSON file
                const dataStr = JSON.stringify(scheduleItems, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                // Create a download link
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `timetable_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('Timetable saved successfully! A backup file has been downloaded.');
            });
            
            // View timetable functionality
            document.getElementById('view-timetable-btn').addEventListener('click', function() {
                // Generate modal timetable
                generateModalTimeSlots();
                renderModalScheduleItems();
                
                // Show modal
                document.getElementById('view-timetable-modal').style.display = 'flex';
            });
            
            // Close modal functionality
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.getElementById('view-timetable-modal').style.display = 'none';
            });
            
            // Modal section filter
            document.getElementById('modal-section-filter').addEventListener('change', function() {
                renderModalScheduleItems();
            });
            
            // Clear timetable functionality
            document.getElementById('clear-timetable-btn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear the entire timetable? This action cannot be undone.')) {
                    scheduleItems = [];
                    saveScheduleItems();
                    renderScheduleItems();
                    alert('Timetable cleared successfully!');
                }
            });
            
            // Load schedule items from localStorage
            loadScheduleItems();
        }
        
        // Initialize time slot selector with fixed time slots
        function initializeTimeSlotSelector() {
            const timeSlotSelector = document.getElementById('time-slot-selector');
            timeSlotSelector.innerHTML = '';
            
            fixedTimeSlots.forEach(slot => {
                const option = document.createElement('div');
                option.className = 'time-slot-option';
                option.dataset.id = slot.id;
                
                option.innerHTML = `
                    <input type="radio" class="time-slot-radio" name="time-slot" value="${slot.id}">
                    <span class="time-slot-label">${slot.label}</span>
                `;
                
                option.addEventListener('click', function() {
                    document.querySelectorAll('.time-slot-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
                
                timeSlotSelector.appendChild(option);
            });
        }
        
        // Generate time slots for the schedule grid using fixed time slots
        function generateTimeSlots() {
            const tbody = document.getElementById('schedule-body');
            if (!tbody) return;
            
            tbody.innerHTML = "";
            
            // Create rows for each fixed time slot
            fixedTimeSlots.forEach(slot => {
                const row = document.createElement('tr');
                
                // Time cell
                const timeCell = document.createElement('td');
                timeCell.className = 'time-column';
                timeCell.textContent = slot.label;
                row.appendChild(timeCell);
                
                // Day cells (Monday to Friday only)
                const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
                for (let day of days) {
                    const dayCell = document.createElement('td');
                    dayCell.id = `cell-${day}-${slot.id}`;
                    dayCell.setAttribute('data-time-slot-id', slot.id);
                    dayCell.setAttribute('data-day', day);
                    row.appendChild(dayCell);
                }
                
                tbody.appendChild(row);
            });
        }
        
        // Generate time slots for the modal schedule grid using fixed time slots
        function generateModalTimeSlots() {
            const tbody = document.getElementById('modal-schedule-body');
            if (!tbody) return;
            
            tbody.innerHTML = "";
            
            // Create rows for each fixed time slot
            fixedTimeSlots.forEach(slot => {
                const row = document.createElement('tr');
                
                // Time cell
                const timeCell = document.createElement('td');
                timeCell.className = 'time-column';
                timeCell.textContent = slot.label;
                row.appendChild(timeCell);
                
                // Day cells (Monday to Friday only)
                const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
                for (let day of days) {
                    const dayCell = document.createElement('td');
                    dayCell.id = `modal-cell-${day}-${slot.id}`;
                    dayCell.setAttribute('data-time-slot-id', slot.id);
                    dayCell.setAttribute('data-day', day);
                    row.appendChild(dayCell);
                }
                
                tbody.appendChild(row);
            });
        }
        
        // Check for time conflicts - UPDATED for teacher conflicts
        function hasTimeConflict(newItem) {
            for (let item of scheduleItems) {
                // Check if the same teacher is scheduled in another section at the same time
                if (item.teacher === newItem.teacher && item.day === newItem.day) {
                    if ((newItem.startMinutes >= item.startMinutes && newItem.startMinutes < item.endMinutes) ||
                        (newItem.endMinutes > item.startMinutes && newItem.endMinutes <= item.endMinutes) ||
                        (newItem.startMinutes <= item.startMinutes && newItem.endMinutes >= item.endMinutes)) {
                        return {
                            hasConflict: true,
                            message: `Teacher ${newItem.teacher} is already teaching in Section ${item.section} at this time!`
                        };
                    }
                }
                
                // Check for section-specific conflicts (same section, same time)
                if (item.section === newItem.section && item.day === newItem.day) {
                    if ((newItem.startMinutes >= item.startMinutes && newItem.startMinutes < item.endMinutes) ||
                        (newItem.endMinutes > item.startMinutes && newItem.endMinutes <= item.endMinutes) ||
                        (newItem.startMinutes <= item.startMinutes && newItem.endMinutes >= item.endMinutes)) {
                        return {
                            hasConflict: true,
                            message: `This time slot conflicts with an existing schedule item in Section ${item.section}!`
                        };
                    }
                }
            }
            return { hasConflict: false, message: "" };
        }
                // Convert time string to minutes
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        // Render schedule items in grid and list views
        function renderScheduleItems() {
            const sectionFilter = document.getElementById('section-filter').value;
            
            // Filter items based on section
            let filteredItems = scheduleItems;
            if (sectionFilter !== 'all') {
                filteredItems = scheduleItems.filter(item => item.section === sectionFilter);
            }
            
            // Clear existing content
            document.querySelectorAll('.schedule-grid td:not(.time-column)').forEach(cell => {
                cell.innerHTML = '';
            });
            
            document.getElementById('schedule-list').innerHTML = '';
            
            // Render grid view
            filteredItems.forEach(item => {
                const cell = document.getElementById(`cell-${item.day}-${getTimeSlotId(item.startTime)}`);
                if (cell) {
                    const subjectBlock = document.createElement('div');
                    subjectBlock.className = `subject-block section-${item.section}`;
                    
                    subjectBlock.innerHTML = `
                        <strong>${item.subject}</strong>
                        <small>${item.teacher}</small>
                        <span class="section-badge">Sec ${item.section}</span>
                    `;
                    
                    cell.appendChild(subjectBlock);
                }
            });
            
            // Render list view
            if (filteredItems.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'list-item';
                emptyMsg.textContent = 'No schedule items found. Add some time slots to get started.';
                document.getElementById('schedule-list').appendChild(emptyMsg);
            } else {
                filteredItems.forEach(item => {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item';
                    
                    listItem.innerHTML = `
                        <div>
                            <strong>${item.subject}</strong> - ${item.teacher}
                            <span class="section-badge section-${item.section}">Sec ${item.section}</span>
                        </div>
                        <div>
                            ${item.day} • ${item.timeSlotLabel}
                        </div>
                    `;
                    
                    document.getElementById('schedule-list').appendChild(listItem);
                });
            }
        }
        
        // Render modal schedule items
        function renderModalScheduleItems() {
            const sectionFilter = document.getElementById('modal-section-filter').value;
            
            // Filter items based on section
            let filteredItems = scheduleItems;
            if (sectionFilter !== 'all') {
                filteredItems = scheduleItems.filter(item => item.section === sectionFilter);
            }
            
            // Clear existing content
            document.querySelectorAll('.modal-schedule-grid td:not(.time-column)').forEach(cell => {
                cell.innerHTML = '';
            });
            
            // Render modal grid view
            filteredItems.forEach(item => {
                const cell = document.getElementById(`modal-cell-${item.day}-${getTimeSlotId(item.startTime)}`);
                if (cell) {
                    const subjectBlock = document.createElement('div');
                    subjectBlock.className = `modal-subject-block section-${item.section}`;
                    
                    subjectBlock.innerHTML = `
                        <strong>${item.subject}</strong>
                        <small>${item.teacher}</small>
                        <span class="section-badge">Sec ${item.section}</span>
                    `;
                    
                    cell.appendChild(subjectBlock);
                }
            });
        }
        
        // Get time slot ID based on start time
        function getTimeSlotId(startTime) {
            const slot = fixedTimeSlots.find(s => s.start === startTime);
            return slot ? slot.id : null;
        }
        
        // Save schedule items to localStorage
        function saveScheduleItems() {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                localStorage.setItem('schedule_' + currentUser, JSON.stringify(scheduleItems));
            }
        }
        
        // Load schedule items from localStorage
        function loadScheduleItems() {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                const savedItems = localStorage.getItem('schedule_' + currentUser);
                if (savedItems) {
                    scheduleItems = JSON.parse(savedItems);
                    renderScheduleItems();
                }
            }
        }
    </script>
</body>
</html>
        
        
